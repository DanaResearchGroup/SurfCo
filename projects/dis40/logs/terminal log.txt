(surfco-venv) benji@Zver:~/SurfCo$ python run_pipeline.py dis40

======================================================================
  SurfCo - Protein Corona Prediction Framework
  Modular KMC Simulation for Nanoparticle-Protein Interactions
======================================================================

  PMF folder: /home/benji/SurfCo/data/surface/C_amorph-1
  Hamaker file: /home/benji/SurfCo/data/hamaker/CarbonBlack.dat
Project: dis40
NP: R=35.0nm, Material=carbonblack, ζ=-15.0mV
Proteins: HSA, FIB-B, HDL, FIB-A
Grid: 393×393 (0.1 nm²/cell)
Configuration loaded in 0.0s

--------------------------------------------------
  Module 1: Energy Calculator
--------------------------------------------------
  Found UA binary at: UnitedAtom
  Calculating binding energies...
    Processing HSA...
      Scanning orientations for HSA in UA... Done
    HSA: E = -150.07 kT
    Processing FIB-B...
      Scanning orientations for FIB-B in UA... Done
    FIB-B: E = -155.15 kT
    Processing HDL...
      Scanning orientations for HDL in UA... Done
    HDL: E = -195.50 kT
    Processing FIB-A...
      Scanning orientations for FIB-A in UA... Done
    FIB-A: E = -141.76 kT

  Probability-based normalization:
    Target probability range: 90% to 99%
    Raw energy range: [-195.5, -141.8] kT
    Target energy range: [-4.60, -2.20]
    HSA: E_raw = -150.1 → E_norm = -2.57
      P_ads(θ=0) = 92.9%, P_des = 7.1%
    FIB-B: E_raw = -155.2 → E_norm = -2.79
      P_ads(θ=0) = 94.2%, P_des = 5.8%
    HDL: E_raw = -195.5 → E_norm = -4.60
      P_ads(θ=0) = 99.0%, P_des = 1.0%
    FIB-A: E_raw = -141.8 → E_norm = -2.20
      P_ads(θ=0) = 90.0%, P_des = 10.0%
  Energy calculation completed in 10.0min

--------------------------------------------------
  Module 2: Projection Calculator
--------------------------------------------------
  Calculating 2D projections...
      Generating 72 rotational masks for HSA (fixed size)...
        Original mask: 402 cells
        Rotated masks: 399-409 cells (variation: 10)
    HSA: Area = 157.86 nm² [✓]
      Generating 72 rotational masks for FIB-B (fixed size)...
        Original mask: 587 cells
        Rotated masks: 577-589 cells (variation: 12)
    FIB-B: Area = 125.18 nm² [✓]
      Generating 72 rotational masks for HDL (fixed size)...
        Original mask: 429 cells
        Rotated masks: 422-433 cells (variation: 11)
    HDL: Area = 71.60 nm² [✓]
      Generating 72 rotational masks for FIB-A (fixed size)...
        Original mask: 779 cells
        Rotated masks: 773-789 cells (variation: 16)
    FIB-A: Area = 208.28 nm² [✓]
  Projection calculation completed in 1.2s

--------------------------------------------------
  Module 3: KMC Simulation
--------------------------------------------------
  Starting simulation...
    Surface: 15393.8 nm²
    Grid: 393×393
    Proteins: 4
    Using 72 rotational masks per protein (5° increments, FIXED SIZE)
  Concentration-based selection probabilities:
    HSA: 45.0 mg/mL (71.4% selection chance, 15.0x relative frequency)
    FIB-B: 3.0 mg/mL (4.8% selection chance, 1.0x relative frequency)
    HDL: 12.0 mg/mL (19.0% selection chance, 4.0x relative frequency)
    FIB-A: 3.0 mg/mL (4.8% selection chance, 1.0x relative frequency)
    Total concentration: 63.0 mg/mL

  Event selection probabilities (FIXED at 99% adsorption):
    HSA: E_norm = -2.57 → Adsorption: 99.0%, Desorption: 1.0% (FIXED)
    FIB-B: E_norm = -2.79 → Adsorption: 99.0%, Desorption: 1.0% (FIXED)
    HDL: E_norm = -4.60 → Adsorption: 99.0%, Desorption: 1.0% (FIXED)
    FIB-A: E_norm = -2.20 → Adsorption: 99.0%, Desorption: 1.0% (FIXED)

  Probability-based displacement penalties (INTUITIVE):
    Base displacement penalty: 15% (any displacement)
    Extra protein penalty: 15% per additional protein
    Minimum displacement chance: 5%
    Coverage threshold for displacement: 40%
    Maximum displacement chance: 70%
  Displacement probability examples:
    1 protein displaced: Base prob × 85% = X × 85%
    2 proteins displaced: Base prob × 85% × 85% = X × 72%
    3 proteins displaced: Base prob × 85% × 70% = X × 60%

    Iteration 1000: 28.7% coverage, 91 proteins (3 it/s)
    Iteration 2000: 39.0% coverage, 140 proteins (3 it/s)
    Iteration 3000: 36.1% coverage, 121 proteins (3 it/s)
    Iteration 4000: 40.2% coverage, 145 proteins (3 it/s)
    Iteration 5000: 25.1% coverage, 84 proteins (3 it/s)
    Iteration 6000: 22.3% coverage, 80 proteins (2 it/s)
    Iteration 7000: 37.7% coverage, 126 proteins (3 it/s)
    Iteration 8000: 32.5% coverage, 116 proteins (3 it/s)
    Iteration 9000: 28.2% coverage, 100 proteins (3 it/s)
    Iteration 10000: 27.7% coverage, 81 proteins (4 it/s)
    Iteration 11000: 33.9% coverage, 115 proteins (4 it/s)
    Iteration 12000: 38.5% coverage, 126 proteins (4 it/s)
    Iteration 13000: 37.5% coverage, 135 proteins (3 it/s)
    Iteration 14000: 26.8% coverage, 94 proteins (2 it/s)
    Iteration 15000: 40.0% coverage, 142 proteins (4 it/s)
    Iteration 16000: 17.1% coverage, 62 proteins (3 it/s)
    Iteration 17000: 32.8% coverage, 109 proteins (4 it/s)
    Iteration 18000: 34.7% coverage, 118 proteins (3 it/s)
    Iteration 19000: 22.4% coverage, 73 proteins (4 it/s)
    Iteration 20000: 35.3% coverage, 108 proteins (3 it/s)
    Iteration 21000: 36.7% coverage, 121 proteins (3 it/s)
    Iteration 22000: 31.2% coverage, 105 proteins (4 it/s)
    Iteration 23000: 39.3% coverage, 136 proteins (3 it/s)
    Iteration 24000: 38.4% coverage, 137 proteins (3 it/s)
    Iteration 25000: 31.0% coverage, 98 proteins (3 it/s)
    Iteration 26000: 39.8% coverage, 140 proteins (3 it/s)
    Iteration 27000: 39.5% coverage, 140 proteins (3 it/s)
    Iteration 28000: 39.6% coverage, 138 proteins (3 it/s)
    Iteration 29000: 31.1% coverage, 107 proteins (4 it/s)
    Iteration 30000: 39.6% coverage, 135 proteins (3 it/s)
    Iteration 31000: 39.1% coverage, 138 proteins (3 it/s)
    Iteration 32000: 33.5% coverage, 128 proteins (4 it/s)
    Iteration 33000: 26.1% coverage, 85 proteins (5 it/s)
    Iteration 34000: 38.5% coverage, 123 proteins (3 it/s)
    Iteration 35000: 34.5% coverage, 114 proteins (4 it/s)
    Iteration 36000: 37.9% coverage, 143 proteins (3 it/s)
    Iteration 37000: 34.3% coverage, 109 proteins (3 it/s)
    Iteration 38000: 37.8% coverage, 135 proteins (3 it/s)
    Iteration 39000: 37.9% coverage, 122 proteins (4 it/s)
    Iteration 40000: 19.6% coverage, 63 proteins (3 it/s)
    Iteration 41000: 26.2% coverage, 85 proteins (4 it/s)
    Iteration 42000: 22.3% coverage, 73 proteins (3 it/s)
    Iteration 43000: 32.6% coverage, 102 proteins (3 it/s)
    Iteration 44000: 33.1% coverage, 107 proteins (4 it/s)
    Iteration 45000: 25.5% coverage, 88 proteins (4 it/s)
    Iteration 46000: 39.9% coverage, 131 proteins (3 it/s)
    Iteration 47000: 34.7% coverage, 114 proteins (4 it/s)
    Iteration 48000: 39.1% coverage, 134 proteins (3 it/s)
    Iteration 49000: 38.1% coverage, 130 proteins (3 it/s)
    Iteration 50000: 38.7% coverage, 132 proteins (3 it/s)
  Simulation complete: 50000 iterations

  Event Statistics (after 50000 iterations):
    Total event attempts: 50000

    Adsorption Events:
      Total attempts: 49474
      Simple adsorption: 23017
      Adsorption with replacement: 306
      Failed (energy): 2857
      Failed (Vroman effect): 588304
      Failed (probability penalties): 1561
      Failed (no space): 23294

    Desorption Events:
      Total attempts: 526
      Successful: 32
      Failed (energy): 494
    Adsorption success rate: 47.1%
    Desorption success rate: 6.1%

    Performance: 3 iterations/second

  Final Results:
    Total coverage: 38.7%
    Total proteins: 132
    HSA: 71 proteins (18.56% coverage, E_norm=-2.57)
    FIB-B: 2 proteins (0.76% coverage, E_norm=-2.79)
    HDL: 46 proteins (12.78% coverage, E_norm=-4.60)
    FIB-A: 13 proteins (6.59% coverage, E_norm=-2.20)
  Simulation completed in 4.2h

--------------------------------------------------
  Module 4: Analysis & Visualization
--------------------------------------------------
  Creating visualizations...
    Protein accumulation plot created
    Coverage plots created
    Final composition plot created
    Surface visualization created
  Visualizations complete
  Visualization completed in 3.3s

======================================================================
  Complete! Results saved to: projects/dis40/
  Total runtime: 4.4h
======================================================================

  Timing Breakdown:
    Configuration: 0.0s
    Energy calculation: 10.0min
    Projection calculation: 1.2s
    Simulation: 4.2h
    Visualization: 3.3s
    Total: 4.4h